[gcode_macro SELECT_FILAMENT]
description: Vybere daný filament (1 až 4)
variable_filament: 1
gcode:
    {% set pos = {'1': 0.0, '2': 40.0, '3': 80.0, '4': 120.0}[params.FILAMENT] %}
    SET_GCODE_VARIABLE MACRO=SELECT_FILAMENT VARIABLE=filament VALUE={params.FILAMENT}
    G1 E-5 F100 ; Retract před výměnou
    G91
    G1 X{pos} F1000 ; Posun na pozici filamentového vstupu
    G90
    M117 Filament #{params.FILAMENT} vybrán

[gcode_macro LOAD_FILAMENT]
description: Načte filament z aktuální pozice do hotendu
gcode:
    G91
    G1 E30 F300 ; Pomalu natáhne filament
    G90
    M117 Filament natažen

[gcode_macro UNLOAD_FILAMENT]
description: Vysune filament z extruderu zpět
gcode:
    G91
    G1 E-30 F500 ; Retract
    G90
    M117 Filament vysunut

[gcode_macro CHANGE_FILAMENT]
description: Změní aktuální filament
gcode:
    {% set new = params.FILAMENT|default("1") %}
    UNLOAD_FILAMENT
    SELECT_FILAMENT FILAMENT={new}
    LOAD_FILAMENT
